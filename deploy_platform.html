<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬äºŒç« çœŸå®æ•°æ®å¯è§†åŒ–å¹³å° - 022340611.xyz</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white; min-height: 100vh; line-height: 1.6;
        }
        .header {
            background: rgba(255,255,255,0.1); 
            padding: 30px 0; text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; color: #4ecdc4; }
        .header p { font-size: 1.2rem; opacity: 0.8; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .controls { 
            background: rgba(255,255,255,0.05); 
            padding: 25px; border-radius: 15px; 
            margin-bottom: 25px; backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .data-selector { margin-bottom: 20px; }
        .data-selector label { display: block; margin-bottom: 10px; font-weight: bold; font-size: 1.1rem; }
        .data-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .data-btn { 
            background: #4ecdc4; border: none; color: white; 
            padding: 12px 20px; border-radius: 8px; cursor: pointer; 
            font-size: 14px; transition: all 0.3s ease; font-weight: 500;
        }
        .data-btn:hover { background: #45b7d1; transform: translateY(-2px); }
        .data-btn.active { background: #ff6b6b; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); }
        .chart-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        .chart-btn { 
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 15px; border-radius: 6px; 
            cursor: pointer; font-size: 14px; transition: all 0.3s ease;
            font-weight: 500;
        }
        .chart-btn:hover { background: rgba(255,255,255,0.2); }
        .chart-btn.active { background: #4ecdc4; border-color: #4ecdc4; }
        .chart-container { 
            background: rgba(255,255,255,0.05); 
            padding: 25px; border-radius: 15px; 
            margin-bottom: 25px; backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        canvas { width: 100% !important; height: 500px !important; }
        .chart-info { 
            margin-top: 20px; padding: 15px; 
            background: rgba(255,255,255,0.05); 
            border-radius: 8px; font-size: 14px; 
            border-left: 4px solid #4ecdc4;
        }
        .data-preview { 
            background: rgba(255,255,255,0.05); 
            padding: 15px; border-radius: 8px; 
            margin-top: 15px; max-height: 200px; overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .loading { text-align: center; padding: 20px; color: #4ecdc4; font-size: 1.1rem; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .data-table th, .data-table td { 
            padding: 8px; text-align: left; 
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .data-table th { background: rgba(255,255,255,0.1); font-weight: 600; }
        .status-bar { 
            background: rgba(255,255,255,0.05); 
            padding: 10px 15px; border-radius: 6px; 
            margin-top: 10px; font-size: 12px; opacity: 0.8;
        }
        .footer {
            text-align: center; padding: 20px; 
            opacity: 0.6; font-size: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ç¬¬äºŒç« çœŸå®æ•°æ®å¯è§†åŒ–å¹³å°</h1>
        <p>åŸºäºå®é™…CSVæ•°æ®çš„äº¤äº’å¼å¯è§†åŒ–åˆ†æ - éƒ¨ç½²ç‰ˆæœ¬</p>
        <div class="status-bar" id="statusBar">å¹³å°å·²å°±ç»ªï¼Œç­‰å¾…æ•°æ®åŠ è½½...</div>
    </div>

    <div class="container">
        <div class="controls">
            <div class="data-selector">
                <label>é€‰æ‹©æ•°æ®é›†ï¼š</label>
                <div class="data-buttons">
                    <button class="data-btn active" onclick="loadDataset('temperature')">ğŸŒ¡ï¸ æ¸©åº¦æ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('alibaba')">ğŸ’° é˜¿é‡Œå·´å·´GMVæ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('shopping')">ğŸ›’ ç½‘è´­æ›¿ä»£ç‡æ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('logistics')">ğŸšš ç‰©æµè´¹ç”¨æ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('car')">ğŸš— æ±½è½¦åˆ¶åŠ¨æ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('power')">âš¡ å‘ç”µé‡æ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('holland')">ğŸ§  éœå…°å¾·æµ‹è¯•æ•°æ®</button>
                    <button class="data-btn" onclick="loadDataset('biomass')">ğŸŒ³ ç»†æ ¹ç”Ÿç‰©é‡æ•°æ®</button>
                </div>
            </div>
            
            <div class="chart-buttons">
                <button class="chart-btn active" onclick="showChart('scatter')">ğŸ“Š æ•£ç‚¹å›¾</button>
                <button class="chart-btn" onclick="showChart('bar')">ğŸ“ˆ æŸ±çŠ¶å›¾</button>
                <button class="chart-btn" onclick="showChart('line')">ğŸ“‰ æŠ˜çº¿å›¾</button>
                <button class="chart-btn" onclick="showChart('pie')">ğŸ¥§ é¥¼å›¾</button>
                <button class="chart-btn" onclick="showChart('histogram')">ğŸ“‹ ç›´æ–¹å›¾</button>
                <button class="chart-btn" onclick="showChart('radar')">ğŸ¯ é›·è¾¾å›¾</button>
                <button class="chart-btn" onclick="showChart('bubble')">ğŸ«§ æ°”æ³¡å›¾</button>
            </div>
        </div>

        <div class="chart-container">
            <div id="loading" class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
            <canvas id="myChart"></canvas>
            <div class="chart-info" id="chartInfo"></div>
            <div class="data-preview" id="dataPreview"></div>
        </div>
    </div>

    <div class="footer">
        éƒ¨ç½²ç‰ˆæœ¬ | æ•°æ®å¯è§†åŒ–å¹³å° | http://022340611.xyz/ | æœ€åæ›´æ–°: 2025/10/17
    </div>

    <script>
        let currentChart = null;
        let currentDataset = null;
        let currentDataType = 'temperature';
        
        // é¢œè‰²é…ç½®
        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'];
        
        // ç¬¬äºŒç« æ•°æ®é›†æè¿°
        const datasetInfo = {
            temperature: {
                name: 'æœªæ¥15å¤©æ¸©åº¦æ•°æ®',
                description: 'å±•ç¤ºæœªæ¥15å¤©çš„æœ€é«˜æ°”æ¸©å’Œæœ€ä½æ°”æ¸©å˜åŒ–è¶‹åŠ¿',
                file: './ç´ æ/æ¸©åº¦æ•°æ®.csv'
            },
            alibaba: {
                name: 'é˜¿é‡Œå·´å·´GMVæ•°æ®',
                description: '2013-2019è´¢å¹´é˜¿é‡Œå·´å·´æ·˜å®å’Œå¤©çŒ«å¹³å°GMVæ•°æ®',
                file: './ç´ æ/é˜¿é‡Œå·´å·´GMVæ•°æ®.csv'
            },
            shopping: {
                name: 'ç½‘è´­æ›¿ä»£ç‡æ•°æ®',
                description: 'å„å•†å“ç§ç±»çš„ç½‘è´­æ›¿ä»£ç‡ç»Ÿè®¡åˆ†æ',
                file: './ç´ æ/ç½‘è´­æ›¿ä»£ç‡æ•°æ®.csv'
            },
            logistics: {
                name: 'ç‰©æµè´¹ç”¨æ•°æ®',
                description: 'ä¸‰å®¶ç‰©æµå…¬å¸å„æœˆçš„ç‰©æµè´¹ç”¨ç»Ÿè®¡',
                file: './ç´ æ/ç‰©æµè´¹ç”¨æ•°æ®.csv'
            },
            car: {
                name: 'æ±½è½¦åˆ¶åŠ¨æ•°æ®',
                description: 'æ±½è½¦é€Ÿåº¦ä¸åˆ¶åŠ¨è·ç¦»çš„å…³ç³»æ•°æ®',
                file: './ç´ æ/æ±½è½¦åˆ¶åŠ¨æ•°æ®.csv'
            },
            power: {
                name: 'å‘ç”µé‡æ•°æ®',
                description: '2017å¹´å’Œ2018å¹´å…¨å›½å‘ç”µé‡ç»Ÿè®¡å¯¹æ¯”',
                file: './ç´ æ/å‘ç”µé‡æ•°æ®.csv'
            },
            holland: {
                name: 'éœå…°å¾·æµ‹è¯•æ•°æ®',
                description: 'éœå…°å¾·èŒä¸šå…´è¶£æµ‹è¯•çš„å…­ä¸ªç»´åº¦å¾—åˆ†',
                file: './ç´ æ/éœå…°å¾·æµ‹è¯•æ•°æ®.csv'
            },
            biomass: {
                name: 'ç»†æ ¹ç”Ÿç‰©é‡æ•°æ®',
                description: '4ä¸ªæ ‘ç§ä¸åŒå­£èŠ‚çš„ç»†æ ¹ç”Ÿç‰©é‡ç»Ÿè®¡',
                file: './ç´ æ/ç»†æ ¹ç”Ÿç‰©é‡æ•°æ®.csv'
            }
        };
        
        // å›¾è¡¨ç±»å‹æè¿°
        const chartDescriptions = {
            scatter: "æ•£ç‚¹å›¾ - æ˜¾ç¤ºä¸¤ä¸ªè¿ç»­å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œé€‚åˆç›¸å…³æ€§åˆ†æ",
            bar: "æŸ±çŠ¶å›¾ - æ¯”è¾ƒä¸åŒç±»åˆ«çš„æ•°å€¼å¤§å°ï¼Œé€‚åˆåˆ†ç±»æ•°æ®å¯¹æ¯”",
            line: "æŠ˜çº¿å›¾ - æ˜¾ç¤ºæ•°æ®éšæ—¶é—´æˆ–å…¶ä»–è¿ç»­å˜é‡çš„è¶‹åŠ¿å˜åŒ–",
            pie: "é¥¼å›¾ - æ˜¾ç¤ºå„éƒ¨åˆ†å æ•´ä½“çš„æ¯”ä¾‹å…³ç³»",
            histogram: "ç›´æ–¹å›¾ - æ˜¾ç¤ºæ•°æ®åˆ†å¸ƒé¢‘ç‡ï¼Œåˆ†ææ•°æ®åˆ†å¸ƒç‰¹å¾",
            radar: "é›·è¾¾å›¾ - å¤šç»´æ•°æ®å¯¹æ¯”åˆ†æï¼Œå±•ç¤ºç»¼åˆè¡¨ç°",
            bubble: "æ°”æ³¡å›¾ - ä¸‰ä¸ªç»´åº¦çš„æ•°æ®å¯è§†åŒ–ï¼Œæ°”æ³¡å¤§å°è¡¨ç¤ºç¬¬ä¸‰ä¸ªå˜é‡"
        };

        // æ›´æ–°çŠ¶æ€æ 
        function updateStatus(message) {
            document.getElementById('statusBar').textContent = message;
        }

        // åŠ è½½æ•°æ®é›†
        function loadDataset(type, event) {
            currentDataType = type;
            document.querySelectorAll('.data-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('myChart').style.display = 'none';
            updateStatus(`æ­£åœ¨åŠ è½½ ${datasetInfo[type].name}...`);
            
            const filePath = datasetInfo[type].file;
            Papa.parse(filePath, {
                download: true,
                header: true,
                complete: function(results) {
                    if (results.errors.length > 0) {
                        console.warn('è§£æè­¦å‘Š:', results.errors);
                        updateStatus(`æ•°æ®åŠ è½½å®Œæˆï¼Œæœ‰ ${results.errors.length} ä¸ªè­¦å‘Š`);
                    }
                    
                    currentDataset = results.data.filter(row => {
                        // è¿‡æ»¤ç©ºè¡Œ
                        return Object.values(row).some(value => value && value.trim() !== '');
                    });
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('myChart').style.display = 'block';
                    updateStatus(`${datasetInfo[type].name} åŠ è½½æˆåŠŸï¼Œå…± ${currentDataset.length} æ¡è®°å½•`);
                    
                    // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
                    showDataPreview();
                    
                    // é»˜è®¤æ˜¾ç¤ºæ•£ç‚¹å›¾
                    showChart('scatter');
                },
                error: function(error) {
                    console.error('æ•°æ®åŠ è½½é”™è¯¯:', error);
                    document.getElementById('loading').innerHTML = 
                        'æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æˆ–ç½‘ç»œè¿æ¥<br>é”™è¯¯ä¿¡æ¯: ' + error.message;
                    updateStatus('æ•°æ®åŠ è½½å¤±è´¥: ' + error.message);
                }
            });
        }

        // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
        function showDataPreview() {
            const preview = document.getElementById('dataPreview');
            if (!currentDataset || currentDataset.length === 0) {
                preview.innerHTML = '<p>æ— æ•°æ®å¯æ˜¾ç¤º</p>';
                return;
            }
            
            const headers = Object.keys(currentDataset[0]);
            let html = `<h4>ğŸ“‹ æ•°æ®é¢„è§ˆ (å‰5è¡Œ)</h4>`;
            html += `<table class="data-table">`;
            html += `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
            
            currentDataset.slice(0, 5).forEach(row => {
                html += `<tr>${headers.map(h => `<td>${row[h] || ''}</td>`).join('')}</tr>`;
            });
            
            html += `</table>`;
            html += `<p>æ€»è®°å½•æ•°: ${currentDataset.length} | åˆ—æ•°: ${headers.length}</p>`;
            preview.innerHTML = html;
        }

        // æ˜¾ç¤ºå›¾è¡¨
        function showChart(type) {
            if (!currentDataset || currentDataset.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>æ— æ•°æ®å¯æ˜¾ç¤ºå›¾è¡¨ï¼Œè¯·æ£€æŸ¥æ•°æ®æ–‡ä»¶</strong>';
                return;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ›´æ–°å›¾è¡¨æè¿°
            document.getElementById('chartInfo').innerHTML = 
                `<strong>${chartDescriptions[type]}</strong><br>æ•°æ®é›†: ${datasetInfo[currentDataType].name}`;
            
            // é”€æ¯ç°æœ‰å›¾è¡¨
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('myChart').getContext('2d');
            updateStatus(`æ­£åœ¨ç”Ÿæˆ ${type} å›¾è¡¨...`);
            
            try {
                switch(type) {
                    case 'scatter':
                        createScatterChart(ctx);
                        break;
                    case 'bar':
                        createBarChart(ctx);
                        break;
                    case 'line':
                        createLineChart(ctx);
                        break;
                    case 'pie':
                        createPieChart(ctx);
                        break;
                    case 'histogram':
                        createHistogramChart(ctx);
                        break;
                    case 'radar':
                        createRadarChart(ctx);
                        break;
                    case 'bubble':
                        createBubbleChart(ctx);
                        break;
                }
                updateStatus(`${type} å›¾è¡¨ç”ŸæˆæˆåŠŸ`);
            } catch (error) {
                console.error('å›¾è¡¨åˆ›å»ºé”™è¯¯:', error);
                document.getElementById('chartInfo').innerHTML = 
                    `<strong>å›¾è¡¨åˆ›å»ºå¤±è´¥: ${error.message}</strong>`;
                updateStatus(`å›¾è¡¨åˆ›å»ºå¤±è´¥: ${error.message}`);
            }
        }

        // åˆ›å»ºæ•£ç‚¹å›¾
        function createScatterChart(ctx) {
            let xData, yData, label, xLabel, yLabel;
            
            if (currentDataType === 'temperature') {
                xData = currentDataset.map(d => parseFloat(d.day));
                yData = currentDataset.map(d => parseFloat(d.maxTemp));
                label = 'å¤©æ•° vs æœ€é«˜æ¸©åº¦';
                xLabel = 'å¤©æ•°';
                yLabel = 'æœ€é«˜æ¸©åº¦ (Â°C)';
            } else if (currentDataType === 'alibaba') {
                xData = currentDataset.map(d => parseInt(d.year.replace('FY', '')));
                yData = currentDataset.map(d => parseFloat(d.gmv));
                label = 'å¹´ä»½ vs GMV';
                xLabel = 'å¹´ä»½';
                yLabel = 'GMV (äº¿å…ƒ)';
            } else if (currentDataType === 'shopping') {
                xData = currentDataset.map((_, i) => i + 1);
                yData = currentDataset.map(d => parseFloat(d.rate));
                label = 'å•†å“ç§ç±» vs æ›¿ä»£ç‡';
                xLabel = 'å•†å“ç§ç±»åºå·';
                yLabel = 'ç½‘è´­æ›¿ä»£ç‡';
            } else if (currentDataType === 'car') {
                xData = currentDataset.map(d => parseFloat(d.speed));
                yData = currentDataset.map(d => parseFloat(d.distance));
                label = 'é€Ÿåº¦ vs åˆ¶åŠ¨è·ç¦»';
                xLabel = 'é€Ÿåº¦ (km/h)';
                yLabel = 'åˆ¶åŠ¨è·ç¦» (m)';
            } else {
                // é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°å€¼åˆ—å’Œç¬¬äºŒä¸ªæ•°å€¼åˆ—
                const headers = Object.keys(currentDataset[0] || {});
                const numericHeaders = headers.filter(h => {
                    const val = currentDataset[0][h];
                    return !isNaN(parseFloat(val)) && val !== '';
                });
                
                if (numericHeaders.length >= 2) {
                    xData = currentDataset.map(d => parseFloat(d[numericHeaders[0]]));
                    yData = currentDataset.map(d => parseFloat(d[numericHeaders[1]]));
                    label = `${numericHeaders[0]} vs ${numericHeaders[1]}`;
                    xLabel = numericHeaders[0];
                    yLabel = numericHeaders[1];
                } else {
                    xData = currentDataset.map((_, i) => i);
                    yData = currentDataset.map(d => parseFloat(Object.values(d)[0] || 0));
                    label = 'åºå· vs æ•°å€¼';
                    xLabel = 'åºå·';
                    yLabel = 'æ•°å€¼';
                }
            }
            
            // è¿‡æ»¤æ— æ•ˆæ•°æ®
            const validData = xData.map((x, i) => ({x: x, y: yData[i]}))
                .filter(point => !isNaN(point.x) && !isNaN(point.y));
            
            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: label,
                        data: validData,
                        backgroundColor: colors[0],
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: xLabel },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: { 
                            title: { display: true, text: yLabel },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // åˆ›å»ºæŸ±çŠ¶å›¾
        function createBarChart(ctx) {
            let labels, data, label;
            
            if (currentDataType === 'temperature') {
                labels = currentDataset.map(d => `ç¬¬${d.day}å¤©`);
                data = currentDataset.map(d => parseFloat(d.maxTemp));
                label = 'æ¯æ—¥æœ€é«˜æ¸©åº¦';
            } else if (currentDataType === 'alibaba') {
                labels = currentDataset.map(d => d.year);
                data = currentDataset.map(d => parseFloat(d.gmv) / 1000); // è½¬æ¢ä¸ºåƒäº¿å…ƒ
                label = 'é˜¿é‡Œå·´å·´GMV (åƒäº¿å…ƒ)';
            } else if (currentDataType === 'shopping') {
                labels = currentDataset.map(d => d.category.substring(0, 8) + '...');
                data = currentDataset.map(d => parseFloat(d.rate) * 100); // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
                label = 'ç½‘è´­æ›¿ä»£ç‡ (%)';
            } else if (currentDataType === 'logistics') {
                labels = currentDataset.map(d => `${d.month}æœˆ`);
                data = currentDataset.map(d => parseFloat(d.companyA));
                label = 'ç‰©æµå…¬å¸Aæœˆè´¹ç”¨';
            } else if (currentDataType === 'car') {
                labels = currentDataset.map(d => `${d.speed}km/h`);
                data = currentDataset.map(d => parseFloat(d.distance));
                label = 'åˆ¶åŠ¨è·ç¦» (m)';
            } else if (currentDataType === 'power') {
                labels = Array.from({length: 12}, (_, i) => `${i+1}æœˆ`);
                data = currentDataset.map(d => parseFloat(d.power2018));
                label = '2018å¹´æœˆå‘ç”µé‡';
            } else {
                // é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªæ–‡æœ¬åˆ—å’Œç¬¬ä¸€ä¸ªæ•°å€¼åˆ—
                const headers = Object.keys(currentDataset[0] || {});
                const textHeaders = headers.filter(h => {
                    const val = currentDataset[0][h];
                    return isNaN(parseFloat(val)) && val !== '';
                });
                const numericHeaders = headers.filter(h => {
                    const val = currentDataset[0][h];
                    return !isNaN(parseFloat(val)) && val !== '';
                });
                
                if (textHeaders.length > 0 && numericHeaders.length > 0) {
                    labels = currentDataset.map(d => d[textHeaders[0]].substring(0, 10));
                    data = currentDataset.map(d => parseFloat(d[numericHeaders[0]]));
                    label = `${numericHeaders[0]}`;
                } else {
                    labels = currentDataset.map((_, i) => `é¡¹ç›®${i+1}`);
                    data = currentDataset.map(d => parseFloat(Object.values(d)[0] || 0));
                    label = 'æ•°å€¼';
                }
            }
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors.slice(0, labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // åˆ›å»ºæŠ˜çº¿å›¾
        function createLineChart(ctx) {
            let labels, data, label;
            
            if (currentDataType === 'mpg') {
                const yearData = {};
                currentDataset.forEach(d => {
                    if (d.year && d.cty) {
                        const year = d.year;
                        const cty = parseFloat(d.cty);
                        if (!yearData[year]) yearData[year] = [];
                        yearData[year].push(cty);
                    }
                });
                
                labels = Object.keys(yearData).sort();
                data = labels.map(year => {
                    const values = yearData[year];
                    return values.reduce((a, b) => a + b) / values.length;
                });
                label = 'å„å¹´ä»½å¹³å‡åŸå¸‚æ²¹è€—';
            } else if (currentDataType === 'usarrests') {
                const sortedData = currentDataset
                    .filter(d => d.State && d.Murder)
                    .sort((a, b) => parseFloat(a.Murder) - parseFloat(b.Murder))
                    .slice(0, 15);
                
                labels = sortedData.map(d => d.State);
                data = sortedData.map(d => parseFloat(d.Murder));
                label = 'å„å·è°‹æ€ç‡ (å‡åºæ’åˆ—)';
            } else {
                const sortedCities = currentDataset
                    .filter(d => d.name && d.pop)
                    .sort((a, b) => parseFloat(b.pop) - parseFloat(a.pop))
                    .slice(0, 15);
                
                labels = sortedCities.map(d => d.name.trim());
                data = sortedCities.map(d => parseFloat(d.pop) / 1000000);
                label = 'äººå£æœ€å¤šçš„15ä¸ªåŸå¸‚ (ç™¾ä¸‡)';
            }
            
            if (data.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>æ— æœ‰æ•ˆæ•°æ®å¯æ˜¾ç¤ºæŠ˜çº¿å›¾</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: colors[0],
                        backgroundColor: colors[0] + '20',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // åˆ›å»ºé¥¼å›¾
        function createPieChart(ctx) {
            let labels, data;
            
            if (currentDataType === 'mpg') {
                const classCount = {};
                currentDataset.forEach(d => {
                    if (d.class) {
                        classCount[d.class] = (classCount[d.class] || 0) + 1;
                    }
                });
                labels = Object.keys(classCount);
                data = Object.values(classCount);
            } else if (currentDataType === 'usarrests') {
                labels = ['ä½çŠ¯ç½ªç‡(<5)', 'ä¸­çŠ¯ç½ªç‡(5-10)', 'é«˜çŠ¯ç½ªç‡(>10)'];
                const murderRates = currentDataset.map(d => parseFloat(d.Murder || 0));
                data = [
                    murderRates.filter(r => r < 5).length,
                    murderRates.filter(r => r >= 5 && r <= 10).length,
                    murderRates.filter(r => r > 10).length
                ];
            } else {
                labels = ['å°åŸå¸‚(<50ä¸‡)', 'ä¸­ç­‰åŸå¸‚(50-100ä¸‡)', 'å¤§åŸå¸‚(>100ä¸‡)'];
                const populations = currentDataset.map(d => parseFloat(d.pop || 0));
                data = [
                    populations.filter(p => p < 500000).length,
                    populations.filter(p => p >= 500000 && p <= 1000000).length,
                    populations.filter(p => p > 1000000).length
                ];
            }
            
            currentChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            labels: { color: 'white' },
                            position: 'right'
                        }
                    }
                }
            });
        }

        // åˆ›å»ºç›´æ–¹å›¾
        function createHistogramChart(ctx) {
            let data, label, xLabel;
            
            if (currentDataType === 'mpg') {
                data = currentDataset.map(d => parseFloat(d.cty || 0)).filter(val => !isNaN(val));
                label = 'åŸå¸‚æ²¹è€—åˆ†å¸ƒ';
                xLabel = 'åŸå¸‚æ²¹è€— (mpg)';
            } else if (currentDataType === 'usarrests') {
                data = currentDataset.map(d => parseFloat(d.Murder || 0)).filter(val => !isNaN(val));
                label = 'è°‹æ€ç‡åˆ†å¸ƒ';
                xLabel = 'è°‹æ€ç‡ (æ¯10ä¸‡äºº)';
            } else {
                data = currentDataset.map(d => {
                    const pop = parseFloat(d.pop || 0);
                    return pop > 0 ? Math.log10(pop) : 0;
                }).filter(val => !isNaN(val));
                label = 'åŸå¸‚äººå£åˆ†å¸ƒ (å¯¹æ•°å°ºåº¦)';
                xLabel = 'äººå£å¯¹æ•° (log10)';
            }
            
            if (data.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>æ— æœ‰æ•ˆæ•°æ®å¯æ˜¾ç¤ºç›´æ–¹å›¾</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors[0] + '80'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            offset: true,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            title: { display: true, text: xLabel, color: 'white' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            title: { display: true, text: 'é¢‘æ•°', color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // åˆ›å»ºé›·è¾¾å›¾
        function createRadarChart(ctx) {
            if (currentDataType !== 'usarrests') {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>é›·è¾¾å›¾æœ€é€‚åˆç¾å›½çŠ¯ç½ªæ•°æ®ï¼Œè¯·åˆ‡æ¢åˆ°USArrestsæ•°æ®é›†</strong>';
                return;
            }
            
            const states = currentDataset.slice(0, 5).filter(state => state.State);
            const labels = ['è°‹æ€ç‡', 'è¢­å‡»ç‡', 'åŸå¸‚äººå£æ¯”ä¾‹', 'å¼ºå¥¸ç‡'];
            
            if (states.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>æ— æœ‰æ•ˆå·æ•°æ®å¯æ˜¾ç¤ºé›·è¾¾å›¾</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: states.map((state, i) => ({
                        label: state.State,
                        data: [
                            parseFloat(state.Murder || 0),
                            parseFloat(state.Assault || 0) / 10,
                            parseFloat(state.UrbanPop || 0),
                            parseFloat(state.Rape || 0)
                        ],
                        backgroundColor: colors[i] + '20',
                        borderColor: colors[i],
                        pointBackgroundColor: colors[i],
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: colors[i]
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255,255,255,0.2)' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            pointLabels: { color: 'white' },
                            ticks: { color: 'white', backdropColor: 'transparent' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // åˆ›å»ºæ°”æ³¡å›¾
        function createBubbleChart(ctx) {
            let data, label, xLabel, yLabel;
            
            if (currentDataType === 'mpg') {
                data = currentDataset.slice(0, 30).map(d => ({
                    x: parseFloat(d.displ || 0),
                    y: parseFloat(d.cty || 0),
                    r: parseFloat(d.cyl || 0) * 2
                })).filter(point => !isNaN(point.x) && !isNaN(point.y) && !isNaN(point.r));
                label = 'æ’é‡ vs æ²¹è€— (æ°”æ³¡å¤§å°è¡¨ç¤ºæ°”ç¼¸æ•°)';
                xLabel = 'æ’é‡ (L)';
                yLabel = 'åŸå¸‚æ²¹è€— (mpg)';
            } else if (currentDataType === 'usarrests') {
                data = currentDataset.map(d => ({
                    x: parseFloat(d.Assault || 0),
                    y: parseFloat(d.Murder || 0),
                    r: parseFloat(d.UrbanPop || 0) / 5
                })).filter(point => !isNaN(point.x) && !isNaN(point.y) && !isNaN(point.r));
                label = 'è¢­å‡»ç‡ vs è°‹æ€ç‡ (æ°”æ³¡å¤§å°è¡¨ç¤ºåŸå¸‚äººå£æ¯”ä¾‹)';
                xLabel = 'è¢­å‡»ç‡ (æ¯10ä¸‡äºº)';
                yLabel = 'è°‹æ€ç‡ (æ¯10ä¸‡äºº)';
            } else {
                data = currentDataset.slice(0, 50).map(d => ({
                    x: parseFloat(d.lon || 0),
                    y: parseFloat(d.lat || 0),
                    r: Math.sqrt(parseFloat(d.pop || 1)) / 1000
                })).filter(point => !isNaN(point.x) && !isNaN(point.y) && !isNaN(point.r));
                label = 'åŸå¸‚åœ°ç†ä½ç½® (æ°”æ³¡å¤§å°è¡¨ç¤ºäººå£)';
                xLabel = 'ç»åº¦';
                yLabel = 'çº¬åº¦';
            }
            
            if (data.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>æ— æœ‰æ•ˆæ•°æ®å¯æ˜¾ç¤ºæ°”æ³¡å›¾</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors[0] + '80',
                        borderColor: colors[0]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: xLabel, color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            title: { display: true, text: yLabel, color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `${label}: (${point.x.toFixed(2)}, ${point.y.toFixed(2)})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // åˆå§‹åŒ–åŠ è½½æ¸©åº¦æ•°æ®
        window.onload = function() {
            updateStatus('å¹³å°åˆå§‹åŒ–å®Œæˆï¼Œæ­£åœ¨åŠ è½½é»˜è®¤æ•°æ®é›†...');
            loadDataset('temperature');
        };

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1': loadDataset('temperature'); break;
                    case '2': loadDataset('alibaba'); break;
                    case '3': loadDataset('shopping'); break;
                    case '4': loadDataset('logistics'); break;
                    case '5': loadDataset('car'); break;
                    case '6': loadDataset('power'); break;
                    case '7': loadDataset('holland'); break;
                    case '8': loadDataset('biomass'); break;
                }
            }
        });
    </script>
</body>
</html>